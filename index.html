<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.9.0/lodash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.2.0/papaparse.js"></script>

  <style>
    .container {
      display: flex;
      width: 100%;
      flex-direction: column;
      justify-content: center;
      z-index: 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="input">
      <input type="file" id="fileInput">
      <input type='button' id='btnLoad' value='Load' onclick='handleFileSelect()'>
    </div>
    <div id="result">
    </div>
  </div>

  <script type="text/javascript">
    function handleFileSelect() {
      input = document.getElementById('fileInput');
      file = input.files[0];
      fr = new FileReader();
      fr.onload = receivedText;
      fr.readAsText(file);
    }

    function receivedText() {
      var data = Papa.parse(fr.result, {
        header: true,
      });
      var entries = data.data;
      var group = _.groupBy(entries, 'age');
      var arr = Object.keys(group);
      // var normalized = _.map(arr, normalizeHeight);
      console.debug('group', arr);
    }

    /**
     * function to normalize abnormal height inputs
     * @method normalizeHeight
     * @param  {Number}        num a number, feet or inches
     * @return {Object}        an object with the normalized height and
     *                            an accuracy rating based on how different
     *                            the number is from an integer
     */
    function normalizeHeight(num) {
      var nums = num.split(/[^0-9]/);
      console.debug(num, nums, nums.length);
      var accuracy = 100;
      // deduct accuracy points for bad input
      if (nums.length > 1) {
        accuracy -= 25;
      }
      var result = parseInt(nums[0]);
      // if a number was entered greater than 12
      // assume its total height in inches and adjust
      // accordingly. also deduct accuracy points
      if (result > 12) {
        result = result % 12;
        accuracy -= 25;
      }

      return ({
        result: result || 0,
        accuracy: accuracy
      });
    }

    /**
     * this function gives a grade based on the age input
     * @method ageGrade
     * @param  {Number} age the age to grade
     * @return {Number}     the grade of the age
     */
    function ageGrade(age) {
      if (age < 16) {
        return 85;
      } else if (age > 16 && age < 30) {
        return 100;
      } else if (age > 30 && age < 40) {
        return 60;
      } else {
        return 40;
      }
    }

    var experience = [
      {level: "", weight: 0},
      {level: "Never  played before", weight: 15},
      {level: 'I have  played pick-up a few times', weight: 30},
      {level: 'I have played in an ultimate League (summer  or winter league) 1-3 years', weight: 45},
      {level: 'I have played  in an ultimate league (summer or winter league) for 4+ years', weight: 60},
      {level: "I have played ultimate at a club level for  4+ years", weight: 75},
      {level: "I have  played college regionals and/or nationals", weight: 90},
      {level: "I have played club regionals and/or nationals", weight: 105}
    ]

    var activity = [
      {level: "", weight: 0},
      {level: "I never  exercise", weight: 0},
      {level: "I play  wii for exercise", weight: 15},
      {level: "Summer League is exercise", weight: 30},
      {level: "I workout outside of ultimate occasionally", weight: 45},
      {level: "I workout at least 3 times a week", weight: 60},
      {level: "I'm a  long distance runner", weight: 75},
      {level: "Sprinting is what I do for fun. I will  be sprinting on the sidelines", weight: 90},
    ]

    var skill = [
      {level: "", weight: 0},
      {level: "Backhand only (still not accurate)", weight: 0},
      {level: "Backhand only (accurate)", weight: 15},
      {level: "Backhand (accurate) and Flick (still not accurate)", weight: 30},
      {level: "Long throws backhand only (Accurate)", weight: 45},
      {level: "Backhand and flick (both accurate)", weight: 60},
      {level: "Long throws backhand and flick (Accurate)", weight: 75},
      {level: "I can put Mikey G's Thumber to shame", weight: 90},
    ]
  </script>
</body>

</html>
